class MalwareHash < ActiveRecord::Base
  validates_uniqueness_of :url
  validates_length_of :url, :is => 32
  
  def self.check(url)
    not find(:first, :conditions => ["url = MD5( ? )", url]).nil?
  end
  
  def self.add_batch(urls)
    return if urls.empty?
    
    values = urls.map {|url| sanitize_sql(["(?)", url])}.join(',')
    MalwareHash.connection.execute("INSERT INTO #{MalwareHash.table_name} (url) VALUES #{values}")
  end
  
  def self.delete_batch(urls)
    return if urls.empty?

    values = urls.map {|url| sanitize_sql(["?", url])}.join(',')
    MalwareHash.connection.execute("DELETE FROM #{MalwareHash.table_name} WHERE url IN (#{values})")
  end
end
